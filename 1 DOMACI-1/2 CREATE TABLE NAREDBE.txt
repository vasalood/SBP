CREATE TABLE "ZAPOSLENI"   
(  
	"Maticni_Broj" NUMBER(13,0), 
	"Plata" NUMBER NOT NULL,  
	"Licno_Ime" VARCHAR2(50) NOT NULL,  
	"Prezime" VARCHAR2(50) NOT NULL,  
	"Datum_Rodjenja" DATE NOT NULL,  
	"Datum_Zaposlenja" DATE NOT NULL,  
	"Godine_Radnog_Staza" NUMBER NOT NULL,  
	"Struka" VARCHAR2(20) NOT NULL,  
	"Dat_Sticanja_Spec" DATE,  
	"Naziv_Spec" VARCHAR2(50),  
	"Inst_Stic_Spec" VARCHAR2(50),  
	"Poseduje_Sertifikat" NUMBER(1,0),  
	"Datum_Vazenja_Sertifikata" DATE,  
	"Tip_Pozicije" VARCHAR2(20) NOT NULL,  
	"Rukovodilac" NUMBER(1,0),  
	"Direktor" NUMBER(1,0),  
	"Sef" NUMBER(1,0),  
	"Dugorocnost_Zaposlenja" VARCHAR2(20),  
	"Datum_Isteka_Ugovora" DATE,  
	"Mat_Br_Rukovodioca" NUMBER(13,0) NOT NULL,  
	"Id_Salona" NUMBER(7,0),
	"Id_Ovlascenog_Servisa" NUMBER(7,0),  

	CONSTRAINT "PK_ZAPOSLENI" PRIMARY KEY("Maticni_Broj"),  
	CONSTRAINT "FK_RUKOVODILAC" FOREIGN KEY ("Mat_Br_Rukovodioca") REFERENCES "ZAPOSLENI"("Maticni_Broj") 

); 

  

CREATE TABLE "PREDSTAVNISTVO" 
(	 
	"Id" NUMBER(7,0), 
	"Grad" VARCHAR2(50) NOT NULL UNIQUE, 
	"Adresa_Predstavnistva" VARCHAR2(50), 
	"Maticni_Broj_Direktora" NUMBER(13,0) NOT NULL, 

	CONSTRAINT "PK_PREDSTAVNISTVO" PRIMARY KEY ("Id"), 
	CONSTRAINT "FK_DIREKTOR" FOREIGN KEY ("Maticni_Broj_Direktora") REFERENCES "ZAPOSLENI"("Maticni_Broj"), 
	CONSTRAINT "UQ_PREDSTAVNISTVO_LOK" UNIQUE("Grad","Adresa_Predstavnistva") 
); 

CREATE TABLE "OVLASCENI_SERVIS"  
( 
	"Id" NUMBER(7,0), 
	"Lokacija" VARCHAR2(100) NOT NULL, 
	"Ime" VARCHAR2(100) NOT NULL, 
	"Stepen_Opremljenosti" VARCHAR2(30) NOT NULL, 
	"Sa_Mehanicarskim_Uslugama" NUMBER(1,0) NOT NULL, 
	"Sa_Limarskim_Uslugama" NUMBER(1,0) NOT NULL, 
	"Sa_Farbarskim_Uslugama" NUMBER(1,0) NOT NULL, 
	"Sa_Vulkanizerskim_Uslugama" NUMBER(1,0) NOT NULL, 
	"Maticni_Broj_Sefa" NUMBER(13,0) NOT NULL, 
	"ID_Servisa_Viseg_Ranga" NUMBER(7,0), 
	"ID_Predstavnistva" NUMBER(7,0) NOT NULL, 

	CONSTRAINT "PK_OVLASCENI_SERVIS" PRIMARY KEY ("Id"), 
	CONSTRAINT "FK_SEF_SERVISA" FOREIGN KEY ("Maticni_Broj_Sefa") REFERENCES "ZAPOSLENI"("Maticni_Broj"), 
	CONSTRAINT "FK_SERVIS_V_RANGA" FOREIGN KEY ("ID_Servisa_Viseg_Ranga") REFERENCES "OVLASCENI_SERVIS"("Id"), 
	CONSTRAINT "FK_PREDSTAVNISTVO_SERVISA" FOREIGN KEY ("ID_Predstavnistva") REFERENCES "PREDSTAVNISTVO"("Id") 
); 

CREATE TABLE "SALON"   
(  
	"Id" NUMBER(7,0),  
	"Lokacija" VARCHAR2(100) UNIQUE,  
	"Ime" VARCHAR2(100),  
	"Maticni_Broj_Sefa" NUMBER(13,0),  
	"Id_Predstavnistva" NUMBER(7,0),  

	CONSTRAINT "PK_SALON" PRIMARY KEY ("Id"),  
	CONSTRAINT "FK_SEF_SALONA" FOREIGN KEY ("Maticni_Broj_Sefa") REFERENCES "ZAPOSLENI"("Maticni_Broj"),  
	CONSTRAINT "FK_PREDSTAVNISTVO_SALONA" FOREIGN KEY ("Id_Predstavnistva") REFERENCES "PREDSTAVNISTVO"("Id"),  
	CONSTRAINT "UQ_SALON_IME_LOK" UNIQUE ("Lokacija","Ime")  

); 

CREATE TABLE "SERVISIRANJE"   
(   
	"Id" NUMBER(7,0),   
	"PFR_Br_Racuna" VARCHAR2(40) UNIQUE,   
	"Id_Servisa" NUMBER(7,0),   
	"Datum_Zavrsetka" DATE,   
	"Maticni_Broj_Primaoca" NUMBER(13,0),   
	"Datum_Prijema" DATE,   
	"Opis_Problema" VARCHAR2(4000),   
	"Id_Servisiranog_Vozila" NUMBER,   

	CONSTRAINT "PK_SERVISIRANJE" PRIMARY KEY ("Id"),   
	CONSTRAINT "FK_SERVIS" FOREIGN KEY ("Id_Servisa") REFERENCES "OVLASCENI_SERVIS"("Id"),   
	CONSTRAINT "FK_PRIMALAC" FOREIGN KEY ("Maticni_Broj_Primaoca") REFERENCES "ZAPOSLENI"("Maticni_Broj")   

);  

ALTER TABLE "ZAPOSLENI" ADD CONSTRAINT "FK_OVLASCENI_SERVIS" FOREIGN KEY ("Id_Ovlascenog_Servisa") REFERENCES "OVLASCENI_SERVIS"("Id") ENABLE;  
ALTER TABLE "ZAPOSLENI" ADD CONSTRAINT "FK_SALON" FOREIGN KEY ("Id_Salona") REFERENCES "SALON"("Id") ENABLE; 

CREATE SEQUENCE  "PREDSTAVNISTVO_ID_SEQ"  MINVALUE 0 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE ;  
CREATE SEQUENCE  "OVLASCENI_SERVIS_ID_SEQ"  MINVALUE 0 MAXVALUE 9999999999999999999999999999 INCREMENT BY 2 START WITH 0 CACHE 20 NOORDER  NOCYCLE ;  
CREATE SEQUENCE  "SALON_ID_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 2 START WITH 1 CACHE 20 NOORDER  NOCYCLE ;  
CREATE SEQUENCE "SERVISIRANJE_ID_SEQ" MINVALUE 0 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 0 CACHE 20 NOORDER NOCYCLE; 

CREATE OR REPLACE TRIGGER "PREDSTAVNISTVO_AUTO_PK"   
    BEFORE INSERT  
    ON "PREDSTAVNISTVO"  
    REFERENCING NEW AS NEW  
    FOR EACH ROW  
BEGIN  
    SELECT "PREDSTAVNISTVO_ID_SEQ".NEXTVAL INTO :NEW."Id" FROM DUAL;  
END;   
/
ALTER TRIGGER "PREDSTAVNISTVO_AUTO_PK" ENABLE; 

CREATE OR REPLACE TRIGGER "OVLASCENI_SERVIS_AUTO_PK"   
    BEFORE INSERT  
    ON "OVLASCENI_SERVIS"  
    REFERENCING NEW AS NEW  
    FOR EACH ROW  
BEGIN  
    SELECT "OVLASCENI_SERVIS_ID_SEQ".NEXTVAL INTO :NEW."Id" FROM DUAL;  
END;   
/
ALTER TRIGGER "OVLASCENI_SERVIS_AUTO_PK" ENABLE; 

CREATE OR REPLACE TRIGGER "SALON_AUTO_PK"   
    BEFORE INSERT  
    ON "SALON" 
    REFERENCING NEW AS NEW  
    FOR EACH ROW  
BEGIN  
    SELECT "SALON_ID_SEQ".NEXTVAL INTO :NEW."Id" FROM DUAL;  
END;  
/
ALTER TRIGGER "SALON_AUTO_PK" ENABLE; 

CREATE OR REPLACE TRIGGER "SERVISIRANJE_AUTO_PK"   
    BEFORE INSERT  
    ON "SERVISIRANJE"  
    REFERENCING NEW AS NEW  
    FOR EACH ROW  
BEGIN  
    SELECT "SERVISIRANJE_ID_SEQ".NEXTVAL INTO :NEW."Id" FROM DUAL;  
END;  
/
ALTER TRIGGER "SERVISIRANJE_AUTO_PK" ENABLE; 

CREATE TABLE "VOZILO" 
(  
	"Id" NUMBER(7,0), 
	"Broj_Sasije" VARCHAR2(30 BYTE) NOT NULL UNIQUE, 
	"Broj_Motora" VARCHAR2(30 BYTE) NOT NULL UNIQUE, 
	"Kubikaza" NUMBER(10,0) NOT NULL , 
	"Tip_goriva" VARCHAR2(30 BYTE) NOT NULL,  
	"Model"	VARCHAR2(30 BYTE) NOT NULL, 
	"Boja" VARCHAR2(30 BYTE) NOT NULL, 
	"VPutnicko" NUMBER(1,0) NOT NULL, 
	"Broj_putnika" NUMBER(10,0), 
	"VTeretno" NUMBER(1,0) NOT NULL, 
	"Nosivost" NUMBER,  
	"Teretni_prostor" VARCHAR2(30 BYTE), 
	"Datum_Uvoza" DATE, 
	"Id_Servisiranog_Vozila" NUMBER(7,0), 
	"Mat_Br_Tehnicara" NUMBER(13,0), 
	"Id_Salona" NUMBER(7,0) 
    ) ; 

ALTER TABLE "VOZILO" ADD CONSTRAINT "VOZILO_PK" PRIMARY KEY ("Id") ENABLE; 
ALTER TABLE "VOZILO" MODIFY ("Id" NOT NULL ENABLE); 
ALTER TABLE "VOZILO" ADD CONSTRAINT "VOZILO_VPUTNICKO_CHK" CHECK ("VPutnicko" IN (1, 0)) ENABLE; 
ALTER TABLE "VOZILO" ADD CONSTRAINT "VOZILO_VTERETNO_CHK" CHECK ("VTeretno" IN (1, 0)) ENABLE; 

CREATE TABLE "SERVISIRANO_VOZILO" 
	( 
		"Id" NUMBER(7,0), 
		"Registarski_broj" VARCHAR2(10 BYTE) NOT NULL UNIQUE , 
		"Godina_Proizvodnje" NUMBER(4,0)  		 
	) ; 
	
ALTER TABLE "SERVISIRANO_VOZILO" ADD CONSTRAINT "SERVISIRANO_VOZILO_PK" PRIMARY KEY ("Id") ENABLE; 
ALTER TABLE "SERVISIRANO_VOZILO" MODIFY ("Id" NOT NULL ENABLE); 
ALTER TABLE "SERVISIRANJE" ADD CONSTRAINT "FK_SERVISIRANO_VOZILO" FOREIGN KEY ("Id_Servisiranog_Vozila") REFERENCES "SERVISIRANO_VOZILO"("Id") ENABLE;   
ALTER TABLE "VOZILO" ADD CONSTRAINT "VOZILO_SERVISIRANO_VOZILO_FK" FOREIGN KEY("Id_Servisiranog_Vozila") REFERENCES "SERVISIRANO_VOZILO" ("Id") ENABLE; 
ALTER TABLE "VOZILO" ADD CONSTRAINT "VOZILO_TEHNICAR_FK" FOREIGN KEY("Mat_Br_Tehnicara") REFERENCES "ZAPOSLENI" ("Maticni_Broj") ENABLE; 
ALTER TABLE "VOZILO" ADD CONSTRAINT "VOZILO_SALON_FK" FOREIGN KEY("Id_Salona") REFERENCES "SALON" ("Id") ENABLE;   

CREATE TABLE "VOZILO_KUPLJENO_NEZAVISNO" 
	( 
		"Vin" NUMBER(7,0), 
		"Ime_Kupca" VARCHAR2(30 BYTE), 
		"Prezime_Kupca" VARCHAR2(30 BYTE), 
		"Broj_Telefona" VARCHAR2(30), 
		"Model" VARCHAR2(30 BYTE) NOT NULL, 
		"ID_Servisiranog_Vozila" NUMBER(7,0) 
	) ; 

ALTER TABLE "VOZILO_KUPLJENO_NEZAVISNO" ADD CONSTRAINT "VOZILO_NEZAVISNO_PK" PRIMARY KEY ("Vin") ENABLE; 
ALTER TABLE "VOZILO_KUPLJENO_NEZAVISNO" MODIFY ("Vin" NOT NULL ENABLE); 
ALTER TABLE "VOZILO_KUPLJENO_NEZAVISNO" MODIFY ("Ime_Kupca" NOT NULL ENABLE); 
ALTER TABLE "VOZILO_KUPLJENO_NEZAVISNO" MODIFY ("Prezime_Kupca" NOT NULL ENABLE); 
ALTER TABLE "VOZILO_KUPLJENO_NEZAVISNO" ADD CONSTRAINT "VOZILO_KUPLJENO_NEZAVISNO_FK" FOREIGN KEY("ID_Servisiranog_Vozila") REFERENCES "SERVISIRANO_VOZILO" ("Id") ENABLE; 

CREATE TABLE "KUPAC"  
( 

	"IdKupca" NUMBER(7,0), 
	"Broj_Telefona1" VARCHAR2(30), 
	"Broj_Telefona2" VARCHAR2(30) 
); 

ALTER TABLE "KUPAC" ADD CONSTRAINT "KUPAC_PK" PRIMARY KEY ("IdKupca") ENABLE; 
ALTER TABLE "KUPAC" MODIFY ("IdKupca" NOT NULL ENABLE); 

CREATE TABLE "PRAVNO_LICE"  
( 
	"PIB" NUMBER(10,0), 
	"Ime" VARCHAR2 (30 BYTE), 
	"Prezime" VARCHAR2 (30 BYTE), 
	"IDK" NUMBER(7,0) 
); 

ALTER TABLE "PRAVNO_LICE" ADD CONSTRAINT "PRAVNO_LICE_PK" PRIMARY KEY ("PIB") ENABLE; 
ALTER TABLE "PRAVNO_LICE" MODIFY ("PIB" NOT NULL ENABLE); 
ALTER TABLE "PRAVNO_LICE" MODIFY ("Ime" NOT NULL ENABLE); 
ALTER TABLE "PRAVNO_LICE" MODIFY ("Prezime" NOT NULL ENABLE); 
ALTER TABLE "PRAVNO_LICE" ADD CONSTRAINT "PRAVNO_LICE_KUPAC_FK" FOREIGN KEY("IDK") REFERENCES "KUPAC" ("IdKupca") ENABLE; 

CREATE TABLE "FIZICKO_LICE"  
( 
	"Maticni_Broj" NUMBER(13,0), 
	"Ime" VARCHAR2 (30 BYTE), 
	"Prezime" VARCHAR2 (30 BYTE), 
	"IDK" NUMBER(7,0) 
); 

ALTER TABLE "FIZICKO_LICE" ADD CONSTRAINT "FIZICKO_LICE_PK" PRIMARY KEY ("Maticni_Broj") ENABLE; 
ALTER TABLE "FIZICKO_LICE" MODIFY ("Maticni_Broj" NOT NULL ENABLE); 
ALTER TABLE "FIZICKO_LICE" MODIFY ("Ime" NOT NULL ENABLE); 
ALTER TABLE "FIZICKO_LICE" MODIFY ("Prezime" NOT NULL ENABLE); 
ALTER TABLE "FIZICKO_LICE" ADD CONSTRAINT "FIZICKO_LICE_KUPAC_FK" FOREIGN KEY("IDK") REFERENCES "KUPAC" ("IdKupca") ENABLE; 

CREATE TABLE "PRODAJA" 
( 
	"Id" NUMBER(7,0) NOT NULL, 
	"Datum_Kupovine" DATE NOT NULL,  
	"Id_Vozila" NUMBER(7,0), 
	"Cena"	NUMBER NOT NULL, 
	"IDK" NUMBER(7,0), 
	"Mat_Br_Prodavca" NUMBER(13,0), 
    "IdS" NUMBER(7,0)
); 

ALTER TABLE "PRODAJA" ADD CONSTRAINT "PRODAJA_PK" PRIMARY KEY ("Id", "Id_Vozila") ENABLE; 

ALTER TABLE "PRODAJA" ADD CONSTRAINT "PRODAJA_VOZILO_FK" FOREIGN KEY("Id_Vozila") 

		REFERENCES "VOZILO" ("Id") ENABLE; 

 ALTER TABLE "PRODAJA" ADD CONSTRAINT "PRODAJA_PRODAVAC_FK" FOREIGN KEY("Mat_Br_Prodavca") 

		REFERENCES "ZAPOSLENI" ("Maticni_Broj") ENABLE; 

 ALTER TABLE "PRODAJA" ADD CONSTRAINT "PRODAJA_SALON_FK" FOREIGN KEY("IdS") 

		REFERENCES "SALON" ("Id") ENABLE; 


CREATE SEQUENCE  "VOZILO_ID_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 100 CACHE 20 NOORDER  NOCYCLE ; 

CREATE SEQUENCE  "SERVISIRANO_VOZILO_ID_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1000 CACHE 20 NOORDER  NOCYCLE ; 

CREATE SEQUENCE  "KUPAC_ID_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 3000 CACHE 20 NOORDER  NOCYCLE ; 

CREATE SEQUENCE  "PRODAJA_ID_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 5000 CACHE 20 NOORDER  NOCYCLE ; 

CREATE OR REPLACE TRIGGER "VOZILO_AUTO_PK" 
    BEFORE INSERT 
    ON "VOZILO" 
    REFERENCING NEW AS NEW 
    FOR EACH ROW 
BEGIN 
    SELECT "VOZILO_ID_SEQ".NEXTVAL INTO :NEW."Id" FROM DUAL; 
END; 
/
ALTER TRIGGER "VOZILO_AUTO_PK" ENABLE; 

CREATE OR REPLACE TRIGGER "SERVISIRANO_VOZILO_AUTO_PK" 
    BEFORE INSERT 
    ON "SERVISIRANO_VOZILO" 
    REFERENCING NEW AS NEW 
    FOR EACH ROW 
BEGIN 
    SELECT "SERVISIRANO_VOZILO_ID_SEQ".NEXTVAL INTO :NEW."Id" FROM DUAL; 
END; 
/
ALTER TRIGGER "SERVISIRANO_VOZILO_AUTO_PK" ENABLE; 
  
CREATE OR REPLACE TRIGGER "KUPAC_AUTO_PK" 
    BEFORE INSERT 
    ON "KUPAC" 
    REFERENCING NEW AS NEW 
    FOR EACH ROW 
BEGIN 
    SELECT "KUPAC_ID_SEQ".NEXTVAL INTO :NEW."IdKupca" FROM DUAL; 
END; 
/
ALTER TRIGGER "KUPAC_AUTO_PK" ENABLE;
  
CREATE OR REPLACE TRIGGER "PRODAJA_AUTO_PK" 
    BEFORE INSERT 
    ON "PRODAJA" 
    REFERENCING NEW AS NEW 
    FOR EACH ROW 
BEGIN 
    SELECT "PRODAJA_ID_SEQ".NEXTVAL INTO :NEW."Id" FROM DUAL; 
END; 
/ 
ALTER TRIGGER "PRODAJA_AUTO_PK" ENABLE; 
